@model GoodsModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var categories = ViewData["categories"] as IEnumerable<SelectListItem>;
}

<div class="row">
    <div class="col-lg-6">
        <form class="form-horizontal">
            <div class="form-group">
                @Html.LabelFor(s => s.Name, new { @class = "col-lg-2 control-label" })
                <div class="col-lg-10">
                    @Html.TextBoxFor(s => s.Name, new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(s => s.Price, new { @class = "col-lg-2 control-label" })
                <div class="col-lg-10">
                    @Html.TextBoxFor(s => s.Price, new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(s => s.CategoryId, new { @class = "col-lg-2 control-label" })
                <div class="col-lg-10">
                    @Html.DropDownListFor(s => s.CategoryId, categories, string.Empty, new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <div class="col-lg-offset-2 col-lg-10">
                    <button type="button" class="btn btn-default" onclick="addGoods()">提交</button>
                </div>
            </div>
        </form>
    </div>
    <div class="col-lg-6" id="property-container">

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#CategoryId').change(function () {
            var categoryId = $(this).children('option:selected').val()
            console.log(categoryId);
            var url = "/GoodsCategoryController/GoodsCategoryPropertyValueView?categoryId=" + categoryId;
            $.ajax({
                type: "get",
                url: view,
                dataType: "html",
                success: function (data) {
                    $('#property-container').html(data);
                },
                error: function (data) {
                    $('#property-container').html('<p>页面错误</p>');
                }
            });
        })

        function addGoods() {
            var name = $('#Name').val();
            var price = $('#Price').val();
            var categoryId = $('#CategoryId').val();
            var properties = [];
            $('.input-propertyValue').each(function (index) {
                var input = $(this);
                var propertyId = input.attr('id').val();
                var value = inpu.val();
                var property = { propertyId: propertyId, value: value };
                console.log(property);
                properties.push(property);
            })

            var data = {
                name: name,
                price: price,
                categoryId: categoryId,
                properties: properties
            }
            console.log(data);
            var url = '/Goods/AddGoods';
            $.ajax({
                type: "post",
                url: url,
                data: data,
                dataType: "json",
                success: function (data) {
                    ajaxSuccess(data, function (data) {
                        window.location.reload();
                    })
                },
                error: function (data) { }
            });
        }
</script>
