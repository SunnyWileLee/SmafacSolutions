@model IEnumerable<OrderChargeModel>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var category = ViewData["category"] as OrderCategoryModel;
    var boundIds = ViewData["boundIds"] as IEnumerable<Guid>;
}


<div class="row">
    <div class="col-lg-6">
        <form class="form-horizontal">
            <div class="form-group">
                <label class="col-lg-2 control-label">类别</label>
                <div class="col-lg-10">
                    <input class="form-control" readonly="readonly" name="@category.Id.ToString()" value="@category.Name" id="id-categoryId" />
                </div>
            </div>
        </form>
    </div>
    <div class="col-lg-6">
        <ul class="list-group">
            @foreach (var charge in Model)
            {
                <li class="list-group-item">
                    <div class="input-group">
                        <span class="input-group-addon">
                            @{
                                var bound = boundIds.Contains(charge.Id);
                                if (bound)
                                {
                                    <input class="checkbox-charge" type="checkbox" aria-label="..." checked="checked" id="@charge.Id">
                                }
                                else
                                {
                                    <input class="checkbox-charge" type="checkbox" aria-label="..." id="@charge.Id">
                                }
                            }
                        </span>
                        <input type="text" readonly="readonly" class="form-control" aria-label="..." value="@charge.Name">
                    </div>
                </li>
                                }
        </ul>
        <div class=" btn-group">
            <input type="button" class="btn btn-success" onclick="bindProperties()" value="确定" />
            <a class="btn btn-default" href="/OrderCategory/OrderCategoryView" type="button">
                <i class="m-icon-swapleft m-icon-white"></i>
                返回列表
            </a>
        </div>      
    </div>
</div>

<script type="text/javascript">
    function bindProperties() {
        var categoryId = $('#id-categoryId').attr('name');
        var bindIds = [];
        $('.checkbox-charge').each(function (index) {
            var checkbox = $(this);
            var checked = checkbox.is(':checked');
            if (checked) {
                var chargeId = checkbox.attr('id');
                bindIds.push(chargeId);
            }
        });

        var data = {
            categoryId: categoryId,
            bindIds: bindIds
        };

        var url = '/OrderCategory/BindCharges';
        $.ajax({
            type: "post",
            url: url,
            data: data,
            dataType: "json",
            success: function (data) {
                ajaxSuccess(data, function (data) {
                    alert('绑定成功');
                }, true)
            },
            error: function (data) { }
        });
    }
</script>
